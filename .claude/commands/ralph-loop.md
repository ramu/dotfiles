---
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(~/.claude/scripts/ralph-loop.sh:*)
description: タスクリストファイルを元に Ralph Loop（自動実装ループ）を実行する
---

# Ralph Loop コマンド

タスクリストファイルを読み込み、未完了タスクを1つずつ自動で **実装 → テスト → コミット → 進捗記録** するループを実行します。

イテレーションごとに `claude -p` で新しいコンテキストを生成するため、コンテキスト枯渇が発生しません。

## 引数の解析

`$ARGUMENT` をスペース区切りで解析:

| 引数 | 必須 | 説明 | デフォルト |
|------|------|------|-----------|
| 第1引数 | ✅ | タスクリストファイルのパス | - |
| 第2引数 | - | 最大イテレーション数 | 10 |

引数が不足している場合はエラーメッセージを表示して終了。

## 対応するタスクリスト形式

### Markdown チェックリスト（推奨）

```markdown
- [ ] ユーザー認証機能を追加
- [ ] APIエンドポイントを実装
- [x] 初期セットアップ（完了済み）
```

### JSON 形式（prd.json 互換）

```json
{
  "userStories": [
    { "id": "US-001", "title": "タスク名", "priority": 1, "passes": false }
  ]
}
```

### その他の形式

番号付きリスト、見出し付きセクションなど、タスクとして認識できる形式に対応。

## 実行手順

### 1. 事前チェック

- タスクリストファイルの存在を確認する（なければエラー終了）
- `git status` で未コミットの変更がないか確認する
- 未コミット変更がある場合はユーザーに警告し、続行するか確認を取る（無関係な変更が混入するリスクがあるため）

### 2. スクリプト実行

以下のコマンドをバックグラウンドで実行する（Bash ツールの `run_in_background: true` を使用）:

```
~/.claude/scripts/ralph-loop.sh <タスクファイルパス> <最大イテレーション数>
```

**注意**: このスクリプトは長時間実行される可能性があるため、必ずバックグラウンドで実行すること。

### 3. ユーザーへの案内

以下の情報をユーザーに伝える:

- Ralph Loop がバックグラウンドで実行中であること
- 進捗ログの場所: `~/tmp/ralph-loop/{プロジェクト名}/{タスクファイル名の拡張子なし}.progress.md`
- タスクファイルに完了マークが随時更新されること
- バックグラウンドタスクの出力は TaskOutput ツールで確認できること
