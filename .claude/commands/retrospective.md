---
allowed-tools: Glob, Read, Bash(git rev-parse *), Bash(git log *)
description: 進捗ログを分析し、振り返りを行う
---

# 振り返りコマンド

`~/tmp/claude-dev/` 配下の進捗ログを分析し、学びのサマリーと次回への改善提案を出力します。

## 引数の解析

`$ARGUMENT` をスペース区切りで解析:

| 引数 | 必須 | 説明 | デフォルト |
|------|------|------|-----------|
| 第1引数 | - | 進捗ログファイルのパス | 自動検出 |

### 進捗ログの自動検出

第1引数が省略された場合:
1. `git rev-parse --show-toplevel` でプロジェクト名を特定
2. `~/tmp/claude-dev/{プロジェクト名}/` ディレクトリから最も更新日時が新しい `.progress.md` ファイルを探す
3. 見つからない場合はエラー終了

## 実行フロー

### Step 1: 進捗ログの読み込み

1. 進捗ログファイルを読み込む
2. 各イテレーションのエントリをパースする（日付、タスク名、実装内容、変更ファイル、学んだこと）

### Step 2: 統計の集計

以下の統計情報を集計する:

- **タスク完了数**: 完了 / スキップ / 合計
- **イテレーション数**: 実行されたイテレーション数
- **変更ファイル数**: ユニークな変更ファイル数
- **スキップ理由**: スキップされたタスクとその理由

### Step 3: パターン分析

進捗ログの「学んだこと」セクションと実装内容を横断的に分析し、以下を抽出する:

#### うまくいったこと
- スムーズに完了したタスクの共通パターン
- 効果的だったアプローチ

#### 問題・ボトルネック
- テスト失敗で再試行が発生したタスク
- スキップされたタスクの傾向
- 時間がかかったと推測されるタスク（変更ファイル数やイテレーション内での進捗から推測）

#### タスク分解の品質
- 粒度が適切だったか（大きすぎたタスクはなかったか）
- 依存順序は正しかったか（手戻りが発生していないか）
- 曖昧な記述のせいで意図と異なる実装になっていないか

### Step 4: 改善提案

分析結果に基づき、次回の開発に向けた具体的な改善提案を行う:

- **タスク分解について**: 粒度の調整、依存関係の明示化、記述の具体化
- **プロジェクト構成について**: テスト環境の整備、設定ファイルの追加
- **ワークフローについて**: 事前準備、並行作業の可否

### Step 5: 結果の表示

以下の形式で振り返り結果を表示する:

```
═══ 振り返り ═══

## 統計
- 完了: {N}/{M} タスク
- スキップ: {N} タスク
- イテレーション: {N} 回
- 変更ファイル: {N} ファイル

## うまくいったこと
- {ポイント1}
- {ポイント2}

## 問題・ボトルネック
- {問題1}: {詳細と原因分析}
- {問題2}: {詳細と原因分析}

## タスク分解の品質評価
- 粒度: {適切 / やや大きい / やや小さい}
- 依存順序: {適切 / 手戻りあり}
- 記述の明確さ: {適切 / 改善の余地あり}

## 次回への改善提案
1. {具体的な改善提案1}
2. {具体的な改善提案2}
3. {具体的な改善提案3}
```

## ルール

- **データに基づく分析**: 推測ではなく、進捗ログの記録に基づいて分析する
- **建設的な提案**: 問題点の指摘だけでなく、具体的な改善アクションを提案する
- **次回の decompose に活かせる形で**: 改善提案は次回のタスク分解時に参照できる具体性を持たせる
